# Docker-machine demo on Packet

## Example of using docker-machine to bring up docker nodes on Packet Bare Metal Cloud


### First make sure you have installed docker-machine and the packet driver. A helpful script to install on ubuntu is provided 

`docker_machine_install.sh`	

#### Bring up nodes on Packet

1. Set environment for API_KEY="your api token"
2. Make sure packet_up.sh is executable by user
3. Execute packet_up to see usage
	

```bash
>./packet_up.sh
./packet_up.sh: usage: <PROJECT_ID> <NODE_TEMPLATE> [NODES]
```

#### Arguments

- *PROJECT_ID* = project to create node in
- *NODE_TEMPLATE* = Prefix for node naming i.e.. test
- *NODES* = # Nodes (default 1)



#### Example - Bring up 3 nodes in project prefixed with node name _test_

./packet_up.sh  98d4a96a-7bad-4ecd-aac9-111823a6cce6 test 3

```
creating node test-1
Running pre-create checks...
Creating machine...
(test-1) Creating SSH key...
(test-1) Provisioning Packet server...
(test-1) Created device ID a86c8224-f8a8-4e73-a9b6-ca77d5b71b5a, IP address 147.75.105.13
(test-1) Waiting for Provisioning...
Waiting for machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting for SSH to be available...
Detecting the provisioner...
Provisioning with ubuntu(systemd)...
Installing Docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env test-1
creating node test-2
Running pre-create checks...
Creating machine...
(test-2) Creating SSH key...
(test-2) Provisioning Packet server...
(test-2) Created device ID 393c4483-9e28-4d53-b257-20c6b43074b5, IP address 147.75.197.239
(test-2) Waiting for Provisioning...
Waiting for machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting for SSH to be available...
Detecting the provisioner...
Provisioning with ubuntu(systemd)...
Installing Docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env test-2
creating node test-3
Running pre-create checks...
Creating machine...
(test-3) Creating SSH key...
(test-3) Provisioning Packet server...
(test-3) Created device ID a2263955-d6d8-46db-ae34-c3e606eb5587, IP address 147.75.76.151
(test-3) Waiting for Provisioning...
Waiting for machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting for SSH to be available...
Detecting the provisioner...
Provisioning with ubuntu(systemd)...
Installing Docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env test-3
```

## Helper Scripts


1. Run nginx by connecting to local docker CLI
```run_nginx.sh```

```
./run_nginx.sh
e9a97bc300947dcd000c5364e01286bf8e4073788355f8b3598779d666e594ac
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                  PORTS                NAMES
e9a97bc30094        nginx               "nginx -g 'daemon of…"   1 second ago        Up Less than a second   0.0.0.0:80->80/tcp   nginx
9f6587698c37314e39fb5d879bec3baa406d8ae921fb69d717e05a2b2de17982
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                  PORTS                NAMES
9f6587698c37        nginx               "nginx -g 'daemon of…"   1 second ago        Up Less than a second   0.0.0.0:80->80/tcp   nginx
```

2. Stop nginx
```stop_nginx.sh```


3. Perform docker ps on each node
```packet_docker_ps.sh```






